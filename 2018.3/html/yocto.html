

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Yocto Recipes For Embedded Flow &mdash; Xilinx Runtime 2018.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Xilinx Runtime 2018.3 documentation" href="index.html"/>
        <link rel="next" title="Developer Build and Test Instructions" href="test.html"/>
        <link rel="prev" title="Building and Installing Software Stack" href="build.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Xilinx Runtime
          

          
          </a>

          
            
            
              <div class="version">
                2018.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="platforms.html">Platform Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution-model.html">Execution Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="xclhal2.main.html">Xilinx Runtime (XRT) Core Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="mgmt-ioctl.main.html">XCLMGMT (PCIe Management Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="xocl_ioctl.main.html">XOCL (PCIe User Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="sysfs.html">Linux Sys FileSystem Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Board Tools and Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="xclbintools.html">Xclbin Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="ert.main.html">Embedded Runtime Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiprocess.html">Multi-Process Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="formats.html">Binary Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building and Installing Software Stack</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Yocto Recipes For Embedded Flow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisite">Prerequisite</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-petalinux-project-with-xrt-recipes">Create PetaLinux Project with XRT recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-xrt-kernel-node-in-device-tree">Add XRT kernel node in device tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-linux-kernel-and-enable-xrt-module">Configure Linux kernel and enable XRT module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Developer Build and Test Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="newdsa-bringup.html">New DSA Bringup</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_platforms.html">Create MPSoC Based Embedded Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="p2p.html">PCIe Peer-to-Peer Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug-faq.html">XRT/Board Debug FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Xilinx Runtime</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Yocto Recipes For Embedded Flow</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/yocto.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="yocto-recipes-for-embedded-flow">
<span id="yocto-rst"></span><h1>Yocto Recipes For Embedded Flow<a class="headerlink" href="#yocto-recipes-for-embedded-flow" title="Permalink to this headline">¶</a></h1>
<p>XRT provide Yocto recipes to build libraries and driver for MPSoC platform.
This page explains how to build Linux image by PetaLinux Tool.
It is NOT targeting to be a PetaLinux document or user guide.
Please read PetaLinux document before you read the rest of this page.</p>
<p><em>NOTE</em> The purpose of this page is only for easy to get started.
If you are interested in details about creating software images for embedded platform.
Please read the Software Platform section of Xilinx Document UG1146.</p>
<div class="section" id="prerequisite">
<h2>Prerequisite<a class="headerlink" href="#prerequisite" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Before start to build Linux image, make sure your have:</dt>
<dd><ol class="first last arabic simple">
<li>PetaLinux tool chain installed and setup;</li>
<li>Hardware Definithion File(.hdf) for your platform;</li>
</ol>
</dd>
</dl>
<p>The PetaLinux tool chain can be downloaded from xilinx.com.
If you don’t have a .hdf file, please see <a class="reference internal" href="create_platforms.html#build-boot-images"><span class="std std-ref">Build Boot Images</span></a>.</p>
</div>
<div class="section" id="create-petalinux-project-with-xrt-recipes">
<h2>Create PetaLinux Project with XRT recipes<a class="headerlink" href="#create-petalinux-project-with-xrt-recipes" title="Permalink to this headline">¶</a></h2>
<p>All of the XRT recipes are in <code class="docutils literal"><span class="pre">&lt;XRT&gt;/src/platform/recipes-xrt</span></code> directory. Where &lt;XRT&gt; is the root directory of your XRT git repository.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Replace &lt;name&gt; in below commands</span>
$ petalinux-create -t project -n &lt;name&gt; --template zynqMP

<span class="c1"># Get HDF file, which is exported by Vivado</span>
$ petalinux-config -p &lt;name&gt; --get-hw-description<span class="o">=</span>&lt;HDF&gt;

<span class="c1"># Go to the project specific directory of the project</span>
$ <span class="nb">cd</span> &lt;name&gt;/project-spec/meta-user/

<span class="c1"># Copy XRT recipes</span>
$ cp -r &lt;XRT&gt;/src/platform/recipes-xrt .

<span class="c1"># If you are using PetaLinux 2018.3 or earlier version, do below steps</span>
$ mkdir recipes-xrt/opencl-headers
$ wget -O recipes-xrt/opencl-headers/opencl-headers_git.bb http://cgit.openembedded.org/meta-openembedded/plain/meta-oe/recipes-core/opencl-headers/opencl-headers_git.bb
</pre></div>
</div>
<p>The above commands create PetaLinux project and add necessary recipes to build XRT library and driver. Please check all the .bb files for details.</p>
<p>The next step is to add all recipes to PetaLinux Rootfs Menu.
Still stay in <code class="docutils literal"><span class="pre">meta-user</span></code> directory. Open <code class="docutils literal"><span class="pre">recipes-core/images/petalinux-image.bbappend</span></code> then add below lines at the end.</p>
<blockquote>
<div><div class="line-block">
<div class="line">IMAGE_INSTALL_append = ” xrt-dev”</div>
<div class="line">IMAGE_INSTALL_append = ” xrt”</div>
<div class="line">IMAGE_INSTALL_append = ” zocl”</div>
</div>
</div></blockquote>
</div>
<div class="section" id="add-xrt-kernel-node-in-device-tree">
<h2>Add XRT kernel node in device tree<a class="headerlink" href="#add-xrt-kernel-node-in-device-tree" title="Permalink to this headline">¶</a></h2>
<p>An example of device tree is in <code class="docutils literal"><span class="pre">&lt;XRT&gt;/src/runtime_src/driver/zynq/fragments/xlnk_dts_fragment_mpsoc.dts</span></code>. You can attach it to <code class="docutils literal"><span class="pre">project-spec/meta-user/recipes-bsp/device-tree/files/system-user.dtsi</span></code> in your PetaLinux project.</p>
</div>
<div class="section" id="configure-linux-kernel-and-enable-xrt-module">
<h2>Configure Linux kernel and enable XRT module<a class="headerlink" href="#configure-linux-kernel-and-enable-xrt-module" title="Permalink to this headline">¶</a></h2>
<p>Now we can configure linux kernel and rootfs.
Please see the comments in below code block. Enable “xrt” and “xrt-dev” options will install XRT libraries and header files to /opt/xilinx/xrt directory in rootfs. Enable “zocl” option will install zocl.ko in rootfs. The zocl.ko driver is a XRT driver module only for MPSoC platform.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1">#Configure Linux kernel (default kernel config is good for zocl driver)</span>
$ petalinux-config -c kernel

<span class="c1"># Configure rootfs, enable below components:</span>
<span class="c1">#   menu -&gt; &quot;user packages&quot; -&gt; xrt</span>
<span class="c1">#   menu -&gt; &quot;user packages&quot; -&gt; xrt-dev</span>
<span class="c1">#   menu -&gt; &quot;user packages&quot; -&gt; zocl</span>
$ petalinux-config -c rootfs

<span class="c1"># Build package</span>
$ petalinux-build
</pre></div>
</div>
<p>You can find all output files from images/linux directory in your PetaLinux project.
These files can be used when creating an embedded platform.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">image.ub</span></code></li>
<li><code class="docutils literal"><span class="pre">bl31.elf</span></code></li>
<li><code class="docutils literal"><span class="pre">fsbl.elf</span></code></li>
<li><code class="docutils literal"><span class="pre">pmufw.elf</span></code></li>
<li><code class="docutils literal"><span class="pre">u-boot.elf</span></code></li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="test.html" class="btn btn-neutral float-right" title="Developer Build and Test Instructions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="build.html" class="btn btn-neutral" title="Building and Installing Software Stack" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Xilinx, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2018.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>