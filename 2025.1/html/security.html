<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Security of Alveo Platform &mdash; XRT Master documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="XRT Python Bindings" href="pyxrt.html" />
    <link rel="prev" title="Accessing vsec within VM" href="vsec.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="index.html" class="icon icon-home"> XRT
            <img src="_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                Master
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">XRT and Vitis™ Platform Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building the XRT Software Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">XRT Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Developer Build and Test Instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Model and Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="execution-model.html">Execution Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_kernel_executions.html">XRT Controlled Kernel Execution Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiprocess.html">Multi-Process Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="p2p.html">PCIe Peer-to-Peer (P2P)</a></li>
<li class="toctree-l1"><a class="reference internal" href="m2m.html">Memory-to-Memory (M2M)</a></li>
<li class="toctree-l1"><a class="reference internal" href="hm.html">Host Memory Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_ini.html">Configuration File xrt.ini</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User API Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="opencl_extension.html">Xilinx OpenCL extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_native_apis.html">XRT Native APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_native.main.html">XRT Native Library C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_native.main.html#id1">XRT Native Library C API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">XRT Developer's Space</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="platforms_partitions.html">Alveo™ Platform Loading Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="sysfs.html">Linux Sys FileSystem Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="formats.html">Binary Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="ert.main.html">Embedded Runtime Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="mgmt-ioctl.main.html">XCLMGMT (PCIe Management Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="xocl_ioctl.main.html">XOCL (PCIe User Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="zocl_ioctl.main.html">ZOCL Driver Interfaces</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools and Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="xclbintools.html">xclbinutil</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbutil.html">xbutil</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbmgmt.html">xbmgmt</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbflash2.html">xbflash2</a></li>
<li class="toctree-l1"><a class="reference internal" href="xball.html">xball</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbtop.html">xbtop</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbtools_map.html">Utility Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="nagios_plugin.html">xrt nagios plugin</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Building Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="yocto.html">XRT Setup for Embedded Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Developer Build and Test Instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cloud Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mailbox.main.html">Mailbox Subdevice Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="mailbox.proto.html">Mailbox Inter-domain Communication Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud_vendor_support.html">MSD/MPD and Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="fpga_device_ready.html">FPGA device readiness within user VM</a></li>
<li class="toctree-l1"><a class="reference internal" href="vsec.html">Accessing vsec within VM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Security of Alveo Platform</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#shell">Shell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pcie-topology">PCIe Topology</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-function-exchange">Dynamic Function eXchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xclbin-generation">Xclbin Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#signing-of-xclbins">Signing of Xclbins</a></li>
<li class="toctree-l2"><a class="reference internal" href="#firewall">Firewall</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pcie-bus-safety">PCIe Bus Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deployment-models">Deployment Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#baremetal">Baremetal</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pass-through-virtualization">Pass-through Virtualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mailbox">Mailbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="#device-reset-and-recovery">Device Reset and Recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shell-update">Shell Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compute-kernel-execution-models">Compute Kernel Execution Models</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python binding</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pyxrt.html">XRT Python Bindings</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug and Faqs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug-faq.html">XRT/Board Debug FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">XRT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Security of Alveo Platform</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/security.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="security-rst"></span><section id="security-of-alveo-platform">
<h1>Security of Alveo Platform<a class="headerlink" href="#security-of-alveo-platform" title="Permalink to this headline">¶</a></h1>
<figure class="align-center align-default" id="id1">
<img alt="_images/XSA-shell.svg" src="_images/XSA-shell.svg" /><figcaption>
<p><span class="caption-text">Alveo shell mgmt and user components, data and control paths</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Security is built into Alveo platform hardware and software architecture. The platform
is made up of two physical partitions: an immutable Shell and user compiled User partition.
This design allows end users to perform Dynamic Function eXchange (Partial Reconfiguration
in classic FPGA terminology) in the well defined User partition while the static Shell
provides key infrastructure services. Alveo shells assume PCIe host (with access to PF0) is
part of <em>Root-of-Trust</em>. The following features reinforce security of the platform:</p>
<ol class="arabic simple">
<li><p>Two physical function shell design</p></li>
<li><p>Clearly classified trusted vs untrusted shell peripherals</p></li>
<li><p>Signing of xclbins</p></li>
<li><p>AXI Firewall</p></li>
<li><p>Well-defined compute kernel execution model</p></li>
<li><p>No direct access to PCIe TLP from User partition</p></li>
<li><p>Treating User partition as untrused partition</p></li>
</ol>
<section id="shell">
<h2>Shell<a class="headerlink" href="#shell" title="Permalink to this headline">¶</a></h2>
<p>The Shell provides core infrastructure to the Alveo platform. It includes <em>hardened</em> PCIe
block which provides physical connectivity to the host PCIe bus via two physical functions
as described in <a class="reference internal" href="platforms.html"><span class="doc">XRT and Vitis™ Platform Overview</span></a>.
The Shell is <em>trusted</em> partition of the Alveo platform and for all practical purposes
should be treated like an ASIC. During system boot, the shell is loaded from the PROM.
Once loaded, the Shell cannot be changed.</p>
<p>In the figure above, the Shell peripherals shaded blue can only be accessed from <em>management</em>
physical function 0 (PF0) while those shaded violet can be accessed from <em>user</em> physical
function 1 (PF1). From PCIe topology point of view PF0 <em>owns</em> the device and performs
supervisory actions on the device. It is part of <em>Root-of-Trust</em>. Peripherals shaded blue
are trusted while those shaded violet are not. Alveo shells use a specialized IP called
<strong>PCIe Demux</strong> which routes PCIe traffic destined for PF0 to PF0 AXI network and those destined
for PF1 to PF1 AXI network. It is responsible for the necessary isolation between PF0 and PF1.</p>
<p>Trusted peripherals includes ICAP for bitstream download (DFX), CMC for sensors and thermal
management, Clock Wizards for clock scaling, QSPI Ctrl for PROM access (shell upgrades), DFX
Isolation, Firewall controls and ERT UART.</p>
<p>All peripherals in the shell except XDMA/QDMA are slaves from PCIe point of view and cannot
initiate PCIe transactions. Alveo shells have one of XDMA or QDMA PCIe DMA engine. Both
<a class="reference external" href="https://www.xilinx.com/support/documentation/ip_documentation/xdma/v4_1/pg195-pcie-dma.pdf">XDMA</a> and
<a class="reference external" href="https://www.xilinx.com/support/documentation/ip_documentation/qdma/v3_0/pg302-qdma.pdf">QDMA</a>
are regular PCIe scatter-gather DMA engine with a well defined programming model.</p>
<p>The Shell provides a <em>control</em> path and a <em>data</em>
path to the user compiled image loaded on User partition. The Firewalls in control and data
paths protect the Shell from un-trusted User partition. For example if a slave in DFX has a
bug or is malicious the appropriate firewall will step in and protect the Shell from the
failing slave as soon as a non compliant AXI transaction is placed on AXI bus.</p>
<p>Newer revisions of shell have a feature called <span class="xref std std-doc">sb</span> which provides direct access to host
memory from kernels in the User partition. With this feature kernels can initiate PCIe burst
transfers from PF1 without direct access to PCIe bus. AXI Firewall (SI) in reverse direction protects
PCIe from non-compliant transfers.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Features <span class="xref std std-doc">sb</span> and <a class="reference internal" href="p2p.html"><span class="doc">PCIe Peer-to-Peer (P2P)</span></a> are not available in all shells.</p>
</div>
<p>For more information on firewall protection see <a class="reference internal" href="#firewall">Firewall</a> section below.</p>
<p>For shell update see <a class="reference internal" href="#shell-update">Shell Update</a> section below.</p>
<p>Compatibility enforcement between Shell and User xclbin is described in <span class="xref std std-doc">platform_partitions</span></p>
<section id="pcie-topology">
<h3>PCIe Topology<a class="headerlink" href="#pcie-topology" title="Permalink to this headline">¶</a></h3>
<p>As mentioned before Alveo platforms have two physical function architecture where each function has its
own BARs. The table below gives overview of the topology and functionality.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 3%" />
<col style="width: 4%" />
<col style="width: 9%" />
<col style="width: 84%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>PF</p></th>
<th class="head"><p>BAR</p></th>
<th class="head"><p>Driver</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>xclmgmt</p></td>
<td><p>Memory mapped access to privileged IPs in the shell as shown
in the Figure above.</p></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>2</p></td>
<td><p>xclmgmt</p></td>
<td><p>Setup MSI-X vector table</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>0</p></td>
<td><p>xocl</p></td>
<td><p>Access to register maps of user compiled compute units in the
DFX region</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>2</p></td>
<td><p>xocl</p></td>
<td><p>Memory mapped access to XDMA/QDMA PCIe DMA engine programming
registers</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>4</p></td>
<td><p>xocl</p></td>
<td><p>CPU direct and P2P access to device attached DDR/HBM/PL-RAM
memory.
By default its size is limited to 256MB but can be expanded
using XRT xbutil tool as described in <a class="reference internal" href="p2p.html"><span class="doc">PCIe Peer-to-Peer (P2P)</span></a></p></td>
</tr>
</tbody>
</table>
<p>Sample output of Linux <code class="docutils literal notranslate"><span class="pre">lspci</span></code> command for U50 device below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dx4300:~&gt;lspci -vvv -d 10ee:
02:00.0 Processing accelerators: Xilinx Corporation Device 5020
        Subsystem: Xilinx Corporation Device 000e
        Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx+
        Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx-
        Latency: 0, Cache Line Size: 64 bytes
        NUMA node: 0
        Region 0: Memory at 20fd2000000 (64-bit, prefetchable) [size=32M]
        Region 2: Memory at 20fd4020000 (64-bit, prefetchable) [size=128K]
        Capabilities: &lt;access denied&gt;
        Kernel driver in use: xclmgmt
        Kernel modules: xclmgmt

02:00.1 Processing accelerators: Xilinx Corporation Device 5021
        Subsystem: Xilinx Corporation Device 000e
        Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx-
        Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx-
        Latency: 0, Cache Line Size: 64 bytes
        Interrupt: pin A routed to IRQ 66
        NUMA node: 0
        Region 0: Memory at 20fd0000000 (64-bit, prefetchable) [size=32M]
        Region 2: Memory at 20fd4000000 (64-bit, prefetchable) [size=128K]
        Region 4: Memory at 20fc0000000 (64-bit, prefetchable) [size=256M]
        Capabilities: &lt;access denied&gt;
        Kernel driver in use: xocl
        Kernel modules: xocl

dx4300:~&gt;
</pre></div>
</div>
</section>
</section>
<section id="dynamic-function-exchange">
<h2>Dynamic Function eXchange<a class="headerlink" href="#dynamic-function-exchange" title="Permalink to this headline">¶</a></h2>
<p>User compiled image packaged as xclbin is loaded on the Dynamic Functional eXchange
partition by the Shell. The image may be signed with a private key and its public
key registered with Linux kernel keyring. The xclbin signature is validated by
xclmgmt driver. This guarantees that only known good user compiled images are loaded by
the Shell. The image load is itself effected by xclmgmt driver which binds to PF0.
xclmgmt driver downloads the bitstream packaged in the bitstream section of xclbin by
programming the ICAP peripheral. The management driver also discovers the target frequency
of the User partition by reading the xclbin clock section and then programs the clocks
which are controlled from Shell. DFX is exposed as one atomic ioctl by xclmgmt driver.</p>
<p>xclbin is a container which packs FPGA bitstream for the User partition and host of related
metadata like clock frequencies, information about instantiated compute units, etc. The
compute units typically expose a well defined register space on the PCIe BAR for access by
XRT. An user compiled image does not have any physical path to directly interact with PCIe
Bus. Compiled images do have access to device DDR.</p>
<p>More information on xclbin can be found in <a class="reference internal" href="formats.html"><span class="doc">Binary Formats</span></a>.</p>
</section>
<section id="xclbin-generation">
<h2>Xclbin Generation<a class="headerlink" href="#xclbin-generation" title="Permalink to this headline">¶</a></h2>
<p>Users compile their Verilog/VHDL/OpenCL/C/C++ design using Vitis™ compiler, v++ which also takes
the shell specification as a second input. By construction the Vitis™ compiler, v++ generates image
compatible with User partition of the shell. The compiler uses a technology called <em>PR Verify</em>
to ensure that the user design physically confines itself to User partition and does not attempt
to overwrite portions of the Shell. It also validates that all the IOs between the DFX and
Shell are going through fixed pins exposed by Shell.</p>
</section>
<section id="signing-of-xclbins">
<h2>Signing of Xclbins<a class="headerlink" href="#signing-of-xclbins" title="Permalink to this headline">¶</a></h2>
<p>xclbin signing process is similar to signing of Linux kernel modules. xclbins can be signed by
XRT <strong>xclbinutil</strong> utility. The signing adds a PKCS7 signature at the end of xclbin. The signing
certificate is then registered with appropriate key-ring. When Linux is running in UEFI secure
mode, signature verification is enforced using signing certification in <em>system</em> key-ring (when
Linux is not running in secure mode there is no such verification).</p>
</section>
<section id="firewall">
<h2>Firewall<a class="headerlink" href="#firewall" title="Permalink to this headline">¶</a></h2>
<p>Alveo hardware design uses standard AXI bus. As shown in the figure the control path uses AXI-Lite
and data path uses AXI4 full. Specialized hardware element called
<a class="reference external" href="https://www.xilinx.com/support/documentation/ip_documentation/axi_firewall/v1_0/pg293-axi-firewall.pdf">AXI Protocol Firewall</a>
monitors all transactions
going across the bus into the un-trusted User partition. It is possible that one or more AXI slave in the DFX
partition is not fully AXI-compliant or deadlocks/stalls/hangs during operation. When an AXI slave in DFX
partition fails, AXI Firewall <em>trips</em> – it starts completing AXI transactions on behalf of the slave so the
master and the specific AXI bus is not impacted – to protect the Shell. The AXI Firewall starts completing
all transactions on behalf of misbehaving slave while also notifying the mgmt driver about the trip. The
xclmgmt driver then starts taking recovery action. xclmgmt posts a XCL_MAILBOX_REQ_FIREWALL message to xocl using
MailBox to inform the peer about FireWall trip. xocl can suggest a reset by sending a XCL_MAILBOX_REQ_HOT_RESET message
to xclmgmt via mailBox. Note that even if no reset is performed the AXI Protocol Firewall will continue to protect the host PCIe bus.
DFX partition will be unavailable till device is reset. <strong>A reboot of host is not required to reset the device.</strong></p>
<p>Alveo boards with multiple FPGA devices on the same board like U30 support card level reset. Mailbox usage by each device on the card
is similar to that of single device cards, however firewall trip in one device will trigger reset to all devices on the card.</p>
<p>AXI Firewall in Slave Interface (SI) mode also protects the host from errant transactions initiated by kernels over
Slave Bridge. For example if an AXI master kernel in the Dynamic Region issues a non compliant AXI transaction like
starting a burst transfer but stalling afterwards, the AXI Firewall (SI) will complete the transaction on behalf of the
failing kernel. This protects PCIe from un-correctable errors.</p>
</section>
<section id="pcie-bus-safety">
<h2>PCIe Bus Safety<a class="headerlink" href="#pcie-bus-safety" title="Permalink to this headline">¶</a></h2>
<p>As explained in the Firewall section above PCIe bus is protected by AXI Firewalls on both control and data path.
DFX Isolation only exposes AXI bus (AXI-Lite for control and AXI-Full for data paths) to the Dynamic Region. Kernels
compiled by user which sit in Dynamic Region do <strong>not have direct access to PCIe bus</strong> and hence cannot generate TLP
packets. This removes the risk of an errant User partition compromising the PCIe bus and taking over the host system. PCIe Demux
IP ensures that all PCIe transactions mastered by device over P2P, XDMA/QDMA and SB data paths are only possible over
PF1. This is critical for <a class="reference internal" href="#pass-through-virtualization">Pass-through Virtualization</a> where host should not see any transactions initiated by PF1.</p>
</section>
<section id="deployment-models">
<h2>Deployment Models<a class="headerlink" href="#deployment-models" title="Permalink to this headline">¶</a></h2>
<p>In all deployment models PCIe host with access to PF0 is considered part of <em>Root-of-Trust</em>.</p>
<section id="baremetal">
<h3>Baremetal<a class="headerlink" href="#baremetal" title="Permalink to this headline">¶</a></h3>
<p>In Baremetal deployment model, both physical functions are visible to the end user who <em>does not</em>
have root privileges. End user have access to both XRT <strong>xclmgmt</strong> and XRT <strong>xocl</strong> drivers. The system
administrator trusts both drivers which provide well defined <a class="reference internal" href="mgmt-ioctl.main.html"><span class="doc">XCLMGMT (PCIe Management Physical Function) Driver Interfaces</span></a> and <a class="reference internal" href="xocl_ioctl.main.html"><span class="doc">XOCL (PCIe User Physical Function) Driver Interfaces</span></a>.
End user does have the privilege to load xclbins which should be signed for maximum security. This
will ensure that only known good xclbins are loaded by end users.</p>
<p>Certain operations like resetting the board and upgrading the flash image on PROM (from which the shell
is loaded on system boot) require root privileges and are effected by xclmgmt driver.</p>
</section>
<section id="pass-through-virtualization">
<h3>Pass-through Virtualization<a class="headerlink" href="#pass-through-virtualization" title="Permalink to this headline">¶</a></h3>
<p>In Pass-through Virtualization deployment model, management physical function (PF0) is only visible to the host
but user physical function (PF1) is visible to the guest VM. Host considers the guest VM a <em>hostile</em> environment.
End users in guest VM may be root and may be running modified implementation of XRT <strong>xocl</strong> driver – XRT
<strong>xclmgmt</strong> driver does not trust XRT xocl driver. xclmgmt as described before exposes well defined
<a class="reference internal" href="mgmt-ioctl.main.html"><span class="doc">XCLMGMT (PCIe Management Physical Function) Driver Interfaces</span></a> to the host. In a good and clean deployment end users in guest VM interact with
standard xocl using well defined <a class="reference internal" href="xocl_ioctl.main.html"><span class="doc">XOCL (PCIe User Physical Function) Driver Interfaces</span></a>.</p>
<p>As explained under the Shell section above, by design xocl has limited access to violet shaded Shell peripherals.
This ensures that users in guest VM cannot perform any privileged operation like updating flash image or device
reset. A user in guest VM can only perform operations listed under USER PF (PF1) section in <a class="reference internal" href="platforms.html"><span class="doc">XRT and Vitis™ Platform Overview</span></a>.</p>
<p>A guest VM user can potentially crash a compute unit in User partition, deadlock data path AXI bus or corrupt
device memory. If the user has root access he may compromise VM memory. But none of this can bring down the
host or the PCIe bus. Host memory is protected by system IOMMU. Device reset and recovery is described below.</p>
<p>A user cannot load a malicious xclbin on the User partition since xclbin downloads are done by xclmgmt
drive. xclbins are passed on to the host via a plugin based MPD/MSD framework defined in
<a class="reference internal" href="mailbox.main.html"><span class="doc">Mailbox Subdevice Driver</span></a>. Host can add any extra checks necessary to validate xclbins received from guest VM.</p>
<p>This deployment model is ideal for public cloud where host does not trust the guest VM. This is the prevalent
deployment model for FaaS operators.</p>
</section>
<section id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2" rowspan="2"><p>Behavior</p></th>
<th class="head" colspan="2"><p>Deployment Model</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Bare Metal</p></th>
<th class="head"><p>Pass-through</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td rowspan="2"><p>System admin
trusts drivers</p></td>
<td><p>xocl</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>xclmgmt</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>End user has
root access</p></td>
<td><p>xocl</p></td>
<td><p>No</p></td>
<td><p>Maybe</p></td>
</tr>
<tr class="row-even"><td><p>xclmgmt</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>End user can crash device</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>End user can crash PCIe bus</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>End user with root access
can crash PCIe bus</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="mailbox">
<h2>Mailbox<a class="headerlink" href="#mailbox" title="Permalink to this headline">¶</a></h2>
<p>Mailbox is used for communication between user physical function driver, xocl and management physical
function driver, xclmgmt. The Mailbox hardware design and xclmgmt driver mailbox handling implementation
has the ability to throttle requests coming from xocl driver.</p>
<p>xclmgmt driver has twofold security protections on the h/w mailbox. From packet layer, xclmgmt monitors
the receiving packet rates and can enforce a threshold. If the receiving packet rates exceeds the threshold,
the mailbox is disabled which prevents the guest from sending any more commands over mailbox. Only
a hot reset on the FPGA device from xclmgmt can recover it. From message layer,system administrator can configure
the xclmgmt driver to ignore specific mailbox opcodes.</p>
<p>Here is an example how System administrator managing the privileged management physical function driver xclmgmt
can configure the mailbox to ignore specific opcodes using xbmgmt utility.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># In host</span>
Host&gt;$ sudo xbmgmt dump --config --output /tmp/config.ini -d bdf

<span class="c1"># Edit the dumped ini file and change the value to key &#39;mailbox_channel_disable&#39;</span>
<span class="c1"># eg. if both xclbin download and reset are to be disabled, one can set</span>
<span class="c1"># mailbox_channel_disable=0x120</span>
<span class="c1"># where 0x120 is 1 &lt;&lt; XCL_MAILBOX_REQ_LOAD_XCLBIN |</span>
<span class="c1">#                1 &lt;&lt; XCL_MAILBOX_REQ_HOT_RESET</span>
<span class="c1"># as defined as below</span>
<span class="c1"># XCL_MAILBOX_REQ_UNKNOWN =             0,</span>
<span class="c1"># XCL_MAILBOX_REQ_TEST_READY =          1,</span>
<span class="c1"># XCL_MAILBOX_REQ_TEST_READ =           2,</span>
<span class="c1"># XCL_MAILBOX_REQ_LOCK_BITSTREAM =      3,</span>
<span class="c1"># XCL_MAILBOX_REQ_UNLOCK_BITSTREAM =    4,</span>
<span class="c1"># XCL_MAILBOX_REQ_HOT_RESET =           5,</span>
<span class="c1"># XCL_MAILBOX_REQ_FIREWALL =            6,</span>
<span class="c1"># XCL_MAILBOX_REQ_LOAD_XCLBIN_KADDR =   7,</span>
<span class="c1"># XCL_MAILBOX_REQ_LOAD_XCLBIN =         8,</span>
<span class="c1"># XCL_MAILBOX_REQ_RECLOCK =             9,</span>
<span class="c1"># XCL_MAILBOX_REQ_PEER_DATA =           10,</span>
<span class="c1"># XCL_MAILBOX_REQ_USER_PROBE =          11,</span>
<span class="c1"># XCL_MAILBOX_REQ_MGMT_STATE =          12,</span>
<span class="c1"># XCL_MAILBOX_REQ_CHG_SHELL =           13,</span>
<span class="c1"># XCL_MAILBOX_REQ_PROGRAM_SHELL =       14,</span>
<span class="c1"># XCL_MAILBOX_REQ_READ_P2P_BAR_ADDR =   15,</span>

Host&gt;$ vi /tmp/config.ini

<span class="c1"># Load config</span>
Host&gt;$ xbmgmt advanced --load-conf --input<span class="o">=</span>/tmp/config.ini -d bdf
</pre></div>
</div>
<p><a class="reference internal" href="mailbox.main.html"><span class="doc">Mailbox Subdevice Driver</span></a> has details on mailbox usage.</p>
</section>
<section id="device-reset-and-recovery">
<h2>Device Reset and Recovery<a class="headerlink" href="#device-reset-and-recovery" title="Permalink to this headline">¶</a></h2>
<p>Device reset and recovery is a privileged operation and can only be performed by xclmgmt driver. xocl
driver can request device reset by sending a message to xclmgmt driver over the Mailbox. An end user
can reset a device by using XRT <strong>xbutil</strong> utility. This utility talks to xocl driver which uses the reset
message as defined in <a class="reference internal" href="mailbox.main.html"><span class="doc">Mailbox Subdevice Driver</span></a></p>
<p>Currently Alveo boards are reset by using PCIe bus <em>hot reset</em> mechanism. This resets the board peripherals
and also the PCIe link. As part of reset, drivers kill all the clients which have opened the device node by
sending them a SIGBUS.</p>
<p>On some Alveo boards like u30, there are multiple FPGA devices supported with help of pcie bifurcation. The
reset in this case is card level reset, which means, a reset issued from one FPGA device will result in all
FPGAs on same board being reset. Both xocl and xclmgmt drivers can identify other FPGA devices on same board
and handle the reset accordingly.</p>
</section>
<section id="shell-update">
<h2>Shell Update<a class="headerlink" href="#shell-update" title="Permalink to this headline">¶</a></h2>
<p>Shell update is like firmware update in conventional PCIe devices. Shell updates are distributed as signed
RPM/DEB package files by Xilinx®. Shells may be upgraded using XRT <strong>xbmgmt</strong> utility by system administrators
only. The upgrade process will update the PROM. A cold reboot of host is required in In order to boot the
platform from the updated image.</p>
</section>
<section id="compute-kernel-execution-models">
<h2>Compute Kernel Execution Models<a class="headerlink" href="#compute-kernel-execution-models" title="Permalink to this headline">¶</a></h2>
<p>XRT and Alveo support software defined compute kernel execution models having standard AXI hardware
interfaces. More details on <a class="reference internal" href="xrt_kernel_executions.html"><span class="doc">XRT Controlled Kernel Execution Models</span></a>. These well understood models do not require
direct register access from user space. To execute a compute kernel XRT has a well defined <em>exec command buffer</em>
API and a <em>wait for exec completion</em> API. These operations are exposed as ioctls by the xocl driver.</p>
</section>
</section>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="vsec.html" class="btn btn-neutral float-left" title="Accessing vsec within VM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pyxrt.html" class="btn btn-neutral float-right" title="XRT Python Bindings" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on October 7, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>