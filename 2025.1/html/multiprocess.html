<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Multi-Process Support &mdash; XRT Master documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="PCIe Peer-to-Peer (P2P)" href="p2p.html" />
    <link rel="prev" title="XRT Controlled Kernel Execution Models" href="xrt_kernel_executions.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="index.html" class="icon icon-home"> XRT
            <img src="_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                Master
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">XRT and Vitis™ Platform Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building the XRT Software Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">XRT Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Developer Build and Test Instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Model and Features</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="execution-model.html">Execution Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_kernel_executions.html">XRT Controlled Kernel Execution Models</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Multi-Process Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#known-issues">Known Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementation-details-for-curious">Implementation Details For Curious</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="p2p.html">PCIe Peer-to-Peer (P2P)</a></li>
<li class="toctree-l1"><a class="reference internal" href="m2m.html">Memory-to-Memory (M2M)</a></li>
<li class="toctree-l1"><a class="reference internal" href="hm.html">Host Memory Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_ini.html">Configuration File xrt.ini</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User API Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="opencl_extension.html">Xilinx OpenCL extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_native_apis.html">XRT Native APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_native.main.html">XRT Native Library C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_native.main.html#id1">XRT Native Library C API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">XRT Developer's Space</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="platforms_partitions.html">Alveo™ Platform Loading Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="sysfs.html">Linux Sys FileSystem Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="formats.html">Binary Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="ert.main.html">Embedded Runtime Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="mgmt-ioctl.main.html">XCLMGMT (PCIe Management Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="xocl_ioctl.main.html">XOCL (PCIe User Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="zocl_ioctl.main.html">ZOCL Driver Interfaces</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools and Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="xclbintools.html">xclbinutil</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbutil.html">xbutil</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbmgmt.html">xbmgmt</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbflash2.html">xbflash2</a></li>
<li class="toctree-l1"><a class="reference internal" href="xball.html">xball</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbtop.html">xbtop</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbtools_map.html">Utility Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="nagios_plugin.html">xrt nagios plugin</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Building Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="yocto.html">XRT Setup for Embedded Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Developer Build and Test Instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cloud Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mailbox.main.html">Mailbox Subdevice Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="mailbox.proto.html">Mailbox Inter-domain Communication Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud_vendor_support.html">MSD/MPD and Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="fpga_device_ready.html">FPGA device readiness within user VM</a></li>
<li class="toctree-l1"><a class="reference internal" href="vsec.html">Accessing vsec within VM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security of Alveo Platform</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python binding</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pyxrt.html">XRT Python Bindings</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug and Faqs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug-faq.html">XRT/Board Debug FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">XRT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Multi-Process Support</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/multiprocess.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="multiprocess-rst"></span><section id="multi-process-support">
<h1>Multi-Process Support<a class="headerlink" href="#multi-process-support" title="Permalink to this headline">¶</a></h1>
<p>Support for Multi-Process kernel execution is default in 2019.1 release.</p>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>Multiple processes can share access to the same device provided each
process uses the same <code class="docutils literal notranslate"><span class="pre">xclbin</span></code>. Attempting to load different xclbins via
different processes concurrently will result in only one process being
successfull in loading its xclbin. The other processes will get error code
-EBUSY or -EPERM.</p>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>If two or more processes execute the same kernel, then these processes
will acquire the kernel’s compute units per the <code class="docutils literal notranslate"><span class="pre">xocl</span></code> kernel driver
compute unit scheduler, which is first-come first-serve.  All
processes have the same priority in XRT.</p>
</section>
<section id="known-issues">
<h2>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<p>Debug and Profile will only be enable for the first process when multi-process
has been enabled. Emulation flow does not have support for multi-process yet.</p>
</section>
<section id="implementation-details-for-curious">
<h2>Implementation Details For Curious<a class="headerlink" href="#implementation-details-for-curious" title="Permalink to this headline">¶</a></h2>
<p>Since 2018.3 downloading an xclbin to the device does not guarantee an automatic lock
on the device for the downloading process. Application is required to create explicit
context for each Compute Unit (CU) it wants to use. OCL applications automatically handle
context creation without user needing to change any code. XRT native applications
should create context on a CU with xclOpenContext() API which requires xclbin UUID
and CU index. This information can be obtained from the xclbin binary. xclOpenContext()
increments the xclbin UUID which prevents that xclbin from being unloaded. A corresponding
xclCloseContext() releases the reference count. xclbins can only be swapped if the reference
count is zero. If an application dies or exits without explicitly releasing the contexts it
had opened before the driver would automatically release the stale contexts.</p>
<p>The following diagram shows a possibility with 7 processes concurrently using a device. The
processes in green are successful but processes in red fail at diffrent stages with appropriate
error codes. Processes P0, P1, P2, P3, P4 and P6 are each trying to use xclbin with UUID_X,
process P5 is attempting to use UUID_Y. Processes P0, P1, P3, P4, and P6 are trying to use CU_0 in
UUID_X. Process P2 is trying to use CU_1 in UUID_X and Process P5 is trying to use CU_0 in UUID_Y.
The diagram shows timeline view with all 7 processes running concurrently.</p>
<figure class="align-default" id="id1">
<div class="graphviz"><object data="_images/graphviz-e3642d1d054f86a195c477303a09c70986745b9d.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph G {
	node [fontname = &quot;Courier&quot;, fontsize = 10];

	subgraph cluster_0 {
		style=filled;
		color=aquamarine3;
		node [style=filled,color=white];
		a0 [label = &quot;xclOpen()&quot;]
		a1 [label = &quot;xclLoadXclBin(UUID_X)&quot;]
		a2 [label = &quot;xclOpenContext(UUID_X, CU_0)&quot;]
		a3 [label = &quot;xclExecBuf(CU_0)&quot;]
		a4 [label = &quot;xclExecWait()&quot;]
		a5 [label = &quot;xclCloseContext(UUID_X, CU_0)&quot;]
		a6 [label = &quot;xclclose()&quot;]
		a0 -&gt; a1 -&gt; a2 -&gt; a3 -&gt; a4 -&gt; a5 -&gt; a6;
		label = &quot;process #0&quot;;
	}

	subgraph cluster_1 {
		style=filled;
		color=aquamarine3;
		node [style=filled,color=white];
		b0 [label = &quot;xclOpen()&quot;]
		b2 [label = &quot;xclOpenContext(UUID_X, CU_0)&quot;]
		b3 [label = &quot;xclExecBuf(CU_0)&quot;]
		b4 [label = &quot;xclExecWait()&quot;]
		b5 [label = &quot;xclCloseContext(UUID_X, CU_0)&quot;]
		b6 [label = &quot;xclclose()&quot;]
		b7 [label = &quot;NOP&quot;]
		b0 -&gt; b7 -&gt; b2 -&gt; b3 -&gt; b4 -&gt; b5 -&gt; b6;
		label = &quot;process #1&quot;;
	}

	subgraph cluster_2 {
		style=filled;
		color=aquamarine3;
		node [style=filled,color=white];
		c0 [label = &quot;xclOpen()&quot;]
		c2 [label = &quot;xclOpenContext(UUID_X, CU_1)&quot;]
		c3 [label = &quot;xclExecBuf(CU_1)&quot;]
		c4 [label = &quot;xclExecWait()&quot;]
		c5 [label = &quot;xclCloseContext(UUID_X, CU_1)&quot;]
		c6 [label = &quot;xclclose()&quot;]
		c7 [label = &quot;NOP&quot;]
		c0 -&gt; c7 -&gt; c2 -&gt; c3 -&gt; c4 -&gt; c5 -&gt; c6;
		label = &quot;process #2&quot;;

	}

	subgraph cluster_3 {
		style=filled;
		color=aquamarine3;
		node [style=filled,color=white];
		d0 [label = &quot;xclOpen()&quot;]
		d1 [label = &quot;xclLoadXclBin(UUID_X)&quot;]
		d2 [label = &quot;xclOpenContext(UUID_X, CU_0)&quot;]
		d3 [label = &quot;xclExecBuf(CU_0)&quot;]
		d4 [label = &quot;xclExecWait()&quot;]
		d5 [label = &quot;xclCloseContext(UUID_X, CU_0)&quot;]
		d6 [label = &quot;xclclose()&quot;]
		d0 -&gt; d1 -&gt; d2 -&gt; d3 -&gt; d4 -&gt; d5 -&gt; d6;
		label = &quot;process #3&quot;;
	}
	subgraph cluster_4 {
		style=filled;
		color=aquamarine3;
		node [style=filled,color=white];
		e0 [label = &quot;xclOpen()&quot;]
		e1 [label = &quot;xclLoadXclBin(UUID_X)&quot;]
		e2 [label = &quot;xclOpenContext(UUID_X, CU_1)&quot;]
		e3 [label = &quot;xclExecBuf(CU_1)&quot;]
		e4 [label = &quot;xclExecWait()&quot;]
		e5 [label = &quot;xclCloseContext(UUID_X, CU_1)&quot;]
		e6 [label = &quot;xclclose()&quot;]
		e7 [label = &quot;NOP&quot;]
		e0 -&gt; e7 -&gt; e1-&gt; e2 -&gt; e3 -&gt; e4 -&gt; e5 -&gt; e6;
		label = &quot;process #4&quot;;
	}
	subgraph cluster_5 {
		style=filled;
		color=indianred;
		node [style=filled,color=white];
		f0 [label = &quot;xclOpen()&quot;]
		f1 [label = &quot;xclLoadXclBin(UUID_Y)&quot;]
		f7 [label = &quot;NOP&quot;]
		f3 [label = &quot;xclclose()&quot;]
		f0 -&gt; f7 -&gt; f1 -&gt; f3;
		label = &quot;process #5&quot;;
	}
	subgraph cluster_6 {
		style=filled;
		color=indianred;
		node [style=filled,color=white];
		g0 [label = &quot;xclOpen()&quot;]
		g1 [label = &quot;xclLoadXclBin(UUID_X)&quot;]
		g2 [label = &quot;xclOpenContext(UUID_Y, CU_0)&quot;]
		g7 [label = &quot;NOP&quot;]
		g3 [label = &quot;xclclose()&quot;]
		g0 -&gt; g7 -&gt;g1 -&gt; g2 -&gt; g3;
		label = &quot;process #6&quot;;
	}
}</p></object></div>
<figcaption>
<p><span class="caption-text">Multi-process interaction diagram</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="xrt_kernel_executions.html" class="btn btn-neutral float-left" title="XRT Controlled Kernel Execution Models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="p2p.html" class="btn btn-neutral float-right" title="PCIe Peer-to-Peer (P2P)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on October 7, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>