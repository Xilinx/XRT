<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FPGA device readiness within user VM &mdash; XRT 2020.1 documentation</title>
      <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Accessing vsec within VM" href="vsec.html" />
    <link rel="prev" title="MSD/MPD and Plugins" href="cloud_vendor_support.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> XRT
          </a>
              <div class="version">
                2020.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">XRT and Vitis™ Platform Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building the XRT Software Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">XRT Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Developer Build and Test Instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Model and Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="execution-model.html">Execution Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_kernel_executions.html">XRT Controlled Kernel Execution Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiprocess.html">Multi-Process Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="p2p.html">PCIe Peer-to-Peer (P2P)</a></li>
<li class="toctree-l1"><a class="reference internal" href="m2m.html">Memory-to-Memory (M2M)</a></li>
<li class="toctree-l1"><a class="reference internal" href="hm.html">Host Memory Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_ini.html">Configuration File xrt.ini</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User API Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="opencl_extension.html">Xilinx OpenCL extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_native_apis.html">XRT Native APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_native.main.html">XRT Native Library C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_native.main.html#id1">XRT Native Library C API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">XRT Developer's Space</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="platforms_partitions.html">Alveo™ Platform Loading Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="sysfs.html">Linux Sys FileSystem Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="formats.html">Binary Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="ert.main.html">Embedded Runtime Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="mgmt-ioctl.main.html">XCLMGMT (PCIe Management Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="xocl_ioctl.main.html">XOCL (PCIe User Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="zocl_ioctl.main.html">ZOCL Driver Interfaces</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools and Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="xclbintools.html">xclbinutil</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbutil.html">xbutil</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbmgmt.html">xbmgmt</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbflash2.html">xbflash2</a></li>
<li class="toctree-l1"><a class="reference internal" href="xball.html">xball</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbtop.html">xbtop</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbtools_map.html">Utility Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="nagios_plugin.html">xrt nagios plugin</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Building Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="yocto.html">XRT Setup for Embedded Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Developer Build and Test Instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cloud Support</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="mailbox.main.html">Mailbox Subdevice Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="mailbox.proto.html">Mailbox Inter-domain Communication Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud_vendor_support.html">MSD/MPD and Plugins</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">FPGA device readiness within user VM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#with-msd-mpd-or-plugins-used">With MSD/MPD or Plugins used</a></li>
<li class="toctree-l2"><a class="reference internal" href="#without-msd-mpd-or-plugins-used">Without MSD/MPD or Plugins used</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vsec.html">Accessing vsec within VM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security of Alveo Platform</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python binding</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pyxrt.html">XRT Python Bindings</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug and Faqs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug-faq.html">XRT/Board Debug FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">XRT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>FPGA device readiness within user VM</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/fpga_device_ready.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="fpga-device-ready-rst"></span><section id="fpga-device-readiness-within-user-vm">
<h1>FPGA device readiness within user VM<a class="headerlink" href="#fpga-device-readiness-within-user-vm" title="Permalink to this headline">¶</a></h1>
<p>To make the FPGA in user VM ready to use, the mgmt side has to be ready first. Beside that, depending on how
the FPGA is deployed, there are still other factors to be considered.</p>
<section id="with-msd-mpd-or-plugins-used">
<h2>With MSD/MPD or Plugins used<a class="headerlink" href="#with-msd-mpd-or-plugins-used" title="Permalink to this headline">¶</a></h2>
<p>In this case, <a class="reference internal" href="mailbox.main.html"><span class="doc">Mailbox Subdevice Driver</span></a> has to be opened from guest VM, and  MPD service must be active in the guest VM.</p>
<p>For MSD/MPD, the MSD service must be active also either from hypervisor or dom0 type VM where the mgmt PF of the FPGA
is assigned.</p>
<p>For Plugins, the vendor specific plugin package has to be installed</p>
</section>
<section id="without-msd-mpd-or-plugins-used">
<h2>Without MSD/MPD or Plugins used<a class="headerlink" href="#without-msd-mpd-or-plugins-used" title="Permalink to this headline">¶</a></h2>
<p>In this case, <a class="reference internal" href="mailbox.main.html"><span class="doc">Mailbox Subdevice Driver</span></a> is still being used, but there is no open to the mailbox subdevice from user,
and MPD service is inactive.
To make the FPGA device ready, the XCL_MAILBOX_REQ_LOAD_XCLBIN opcode has to be disabled in xclmgmt.
System administrator managing the privileged management physical function driver xclmgmt can disable specific opcodes
using xbmgmt utility as follows.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># In host</span>
Host&gt;$ sudo xbmgmt dump --config --output /tmp/config.ini -d bdf

<span class="c1"># Edit the dumped ini file and change the value to key &#39;mailbox_channel_disable&#39;</span>
<span class="c1"># mailbox_channel_disable=0x100,</span>
<span class="c1"># where 0x100 is 1 &lt;&lt; XCL_MAILBOX_REQ_LOAD_XCLBIN, as defined as below</span>
<span class="c1"># XCL_MAILBOX_REQ_UNKNOWN =             0,</span>
<span class="c1"># XCL_MAILBOX_REQ_TEST_READY =          1,</span>
<span class="c1"># XCL_MAILBOX_REQ_TEST_READ =           2,</span>
<span class="c1"># XCL_MAILBOX_REQ_LOCK_BITSTREAM =      3,</span>
<span class="c1"># XCL_MAILBOX_REQ_UNLOCK_BITSTREAM =    4,</span>
<span class="c1"># XCL_MAILBOX_REQ_HOT_RESET =           5,</span>
<span class="c1"># XCL_MAILBOX_REQ_FIREWALL =            6,</span>
<span class="c1"># XCL_MAILBOX_REQ_LOAD_XCLBIN_KADDR =   7,</span>
<span class="c1"># XCL_MAILBOX_REQ_LOAD_XCLBIN =         8,</span>
<span class="c1"># XCL_MAILBOX_REQ_RECLOCK =             9,</span>
<span class="c1"># XCL_MAILBOX_REQ_PEER_DATA =           10,</span>
<span class="c1"># XCL_MAILBOX_REQ_USER_PROBE =          11,</span>
<span class="c1"># XCL_MAILBOX_REQ_MGMT_STATE =          12,</span>
<span class="c1"># XCL_MAILBOX_REQ_CHG_SHELL =           13,</span>
<span class="c1"># XCL_MAILBOX_REQ_PROGRAM_SHELL =       14,</span>
<span class="c1"># XCL_MAILBOX_REQ_READ_P2P_BAR_ADDR =   15,</span>

Host&gt;$ vi /tmp/config.ini

<span class="c1"># Load config</span>
Host&gt;$ xbmgmt advanced --load-conf --input<span class="o">=</span>/tmp/config.ini -d bdf
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cloud_vendor_support.html" class="btn btn-neutral float-left" title="MSD/MPD and Plugins" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="vsec.html" class="btn btn-neutral float-right" title="Accessing vsec within VM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2020, Xilinx, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>