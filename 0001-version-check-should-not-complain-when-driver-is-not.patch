From 641e600231e8caaff4923e2507b3945e01fa67a5 Mon Sep 17 00:00:00 2001
From: Max Zhen <maxz@xilinx.com>
Date: Wed, 28 Aug 2019 16:55:07 -0700
Subject: [PATCH] version check should not complain when driver is not loaded

---
 src/runtime_src/core/pcie/tools/xbmgmt/xbmgmt.cpp | 3 ++-
 src/runtime_src/core/pcie/tools/xbutil/xbutil.cpp | 3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/runtime_src/core/pcie/tools/xbmgmt/xbmgmt.cpp b/src/runtime_src/core/pcie/tools/xbmgmt/xbmgmt.cpp
index 8296f10..a70c4e8 100644
--- a/src/runtime_src/core/pcie/tools/xbmgmt/xbmgmt.cpp
+++ b/src/runtime_src/core/pcie/tools/xbmgmt/xbmgmt.cpp
@@ -132,7 +132,8 @@ int xrt_xbmgmt_version_cmp()
 {
     /*check xbutil tools and xrt versions*/
     std::string xrt = std::string(xrt_build_version) + "," + std::string(xrt_build_version_hash);
-    if ( xrt.compare(driver_version("xocl") ) != 0 ) {
+    if ( driver_version("xclmgmt") != "unknown" &&
+        xrt.compare(driver_version("xclmgmt") ) != 0 ) {
         std::cout << "\nERROR: Mixed versions of XRT and xbmgmt are not supported. \
             \nPlease install matching versions of XRT and xbmgmt or  \
             \ndefine env variable INTERNAL_BUILD to disable this check\n" << std::endl;
diff --git a/src/runtime_src/core/pcie/tools/xbutil/xbutil.cpp b/src/runtime_src/core/pcie/tools/xbutil/xbutil.cpp
index 71d55d3..45972fd 100644
--- a/src/runtime_src/core/pcie/tools/xbutil/xbutil.cpp
+++ b/src/runtime_src/core/pcie/tools/xbutil/xbutil.cpp
@@ -118,7 +118,8 @@ int xrt_xbutil_version_cmp()
     /*check xbutil tools and xrt versions*/
     std::string xrt = sensor_tree::get<std::string>( "runtime.build.version", "N/A" ) + "," 
         + sensor_tree::get<std::string>( "runtime.build.hash", "N/A" );
-    if ( xrt.compare(xcldev::driver_version("xocl") ) != 0 ) {
+    if ( xcldev::driver_version("xocl") != "unknown" &&
+        xrt.compare(xcldev::driver_version("xocl") ) != 0 ) {
         std::cout << "\nERROR: Mixed versions of XRT and xbutil are not supported. \
             \nPlease install matching versions of XRT and xbutil or  \
             \ndefine env variable INTERNAL_BUILD to disable this check\n" << std::endl;
-- 
1.8.3.1

