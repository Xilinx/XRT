

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>New XSA Bringup &mdash; XRT 2019.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> XRT
          

          
          </a>

          
            
            
              <div class="version">
                2019.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">Platform Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building and Installing Software Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Developer Build and Test Instructions</a></li>
</ul>
<p class="caption"><span class="caption-text">Use Model and Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="execution-model.html">Execution Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_kernel_executions.html">Supported Kernel Execution Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiprocess.html">Multi-Process Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="p2p.html">PCIe Peer-to-Peer (P2P) Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="m2m.html">Memory-to-Memory (M2M) Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="streaming_data_support.html">XRT Streaming Platform Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_ini.html">Configuration File xrt.ini</a></li>
</ul>
<p class="caption"><span class="caption-text">Video Acceleration Using XMA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="xma_user_guide.html">Xilinx Media Accelerator (XMA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="xma_19.2.html">XMA 19.2 Migration</a></li>
</ul>
<p class="caption"><span class="caption-text">User API Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="xrt.main.html">XRT Core Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="ert.main.html">Embedded Runtime Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="xma.main.html">XMA Core Library</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT Developer's Space</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sysfs.html">Linux Sys FileSystem Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="formats.html">Binary Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="mgmt-ioctl.main.html">XCLMGMT (PCIe Management Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="xocl_ioctl.main.html">XOCL (PCIe User Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="zocl_ioctl.main.html">ZOCL Driver Interfaces</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools and Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="xclbintools.html">xclbinutil</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbutil.html">xbutil</a></li>
<li class="toctree-l1"><a class="reference internal" href="xbmgmt.html">xbmgmt</a></li>
</ul>
<p class="caption"><span class="caption-text">Building Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="yocto.html">Yocto Recipes For Embedded Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Developer Build and Test Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_platforms.html">Create MPSoC Based Embedded Platforms</a></li>
</ul>
<p class="caption"><span class="caption-text">Cloud Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mailbox.main.html">Mailbox Subdevice Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="mailbox.proto.html">Mailbox Inter-domain Communication Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud_vendor_support.html">MSD/MPD and Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Security</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security of Alveo Platform</a></li>
</ul>
<p class="caption"><span class="caption-text">Debug and Faqs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug-faq.html">XRT/Board Debug FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">XRT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>New XSA Bringup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/newxsa-bringup.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="new-xsa-bringup">
<h1>New XSA Bringup<a class="headerlink" href="#new-xsa-bringup" title="Permalink to this headline">¶</a></h1>
<p>To fullfill the different requirements, new XSAs are invented based on existing SDAccel XSAs. The first thing to verify the new XSA with XRT is to attach XRT drivers with it and see how it works. Then it might need to customizing and making changes in XRT to support the new XSA.</p>
<p>This section focuses on how to modify XRT drivers to identify the new XSA and how to customize XRT drivers for new XSA.</p>
<div class="section" id="assumption">
<h2>Assumption<a class="headerlink" href="#assumption" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>The firmware(.dsabin) file along with the new XSA is installed to the host properly. This firmware file could contain FPGA flash image, XMC image, microblaze image etc. which is consumed by driver and tools.</li>
<li>The new XSA bitstream is programed to the FPGA board properly.</li>
</ol>
</div>
<div class="section" id="identify-xsa">
<h2>Identify XSA<a class="headerlink" href="#identify-xsa" title="Permalink to this headline">¶</a></h2>
<p>There are two factor could be used to identify the new XSA. The first is PCI vendor-id, device-id and subsystem-id combination. The second is XSA VBNV name. For XRT driver <code class="docutils literal notranslate"><span class="pre">src/runtime_src/core/pcie/driver/linux/xocl/devices.h</span></code> need to be changed to identify the new XSA.</p>
<div class="section" id="add-new-pci-id-combination">
<h3>Add new PCI ID combination<a class="headerlink" href="#add-new-pci-id-combination" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Open devices.h and search</dt>
<dd><p class="first"><code class="docutils literal notranslate"><span class="pre">XOCL_MGMT_PCI_IDS</span></code>      for management PCI function</p>
<p><code class="docutils literal notranslate"><span class="pre">XOCL_USER_XDMA_PCI_IDS</span></code> for XDMA user PCI function</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">XOCL_USER_QDMA_PCI_IDS</span></code> for QDMA user PCI function</p>
</dd>
</dl>
<p>Then add entries corresponding for the new XSA. The PCI ID combination has to be unique. <code class="docutils literal notranslate"><span class="pre">PCI_ANY_ID</span></code> is acceptable wildcast. The behavior of overlapped combination is undefined.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ XOCL_PCI_DEVID(0x10EE, 0x4B88, 0x4351, USER_XDMA) },
{ XOCL_PCI_DEVID(0x10EE, 0x6850, PCI_ANY_ID, USER_XDMA) },
</pre></div>
</div>
<p>The “USER_XDMA” in above example is XSA profile macro which describes the IPs implemented by the XSA.</p>
</div>
<div class="section" id="add-new-vbna">
<h3>Add new VBNA<a class="headerlink" href="#add-new-vbna" title="Permalink to this headline">¶</a></h3>
<p>In some cases, two different XSAs use the same PCI ID combination. VBNV is used to identify them. Macro <code class="docutils literal notranslate"><span class="pre">XOCL_DSA_VBNV_MAP</span></code> in devices.h is used to combine the VBNV name with XSA profile macro.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ 0x10EE, 0x5001, PCI_ANY_ID, &quot;xilinx_u200_xdma_201820_1&quot;, &amp;XOCL_BOARD_USER_XDMA },
</pre></div>
</div>
<p>Above example specifies xdma XSA profile for XSA which has VBNV “xilinx_u200_xdma_201820_1”. This is going to overwrite the XSA profile combination defined in PCI ID table.</p>
</div>
</div>
<div class="section" id="customize-xsa">
<h2>Customize XSA<a class="headerlink" href="#customize-xsa" title="Permalink to this headline">¶</a></h2>
<p>Each XSA is described by a XSA profile macro in devices.h. This macro defines all the required information of XSA, include IP implemented in XSA, IO address and IRQ ranges for each IP, flags etc. The easiest way for new XSA is inheriting from an existing profile and customizing it.</p>
<p>Here are the supported IPs. And IO address and IRQ ranged are pre-defined in devices.h. If the new XSA introduces new IP or changes the IO address or IRQ, it has to add or modify the corresponding macro. For new IP, XRT is going to create a sub device node (platform devcie) and the driver of the new IP has to developed.</p>
<blockquote>
<div><p>feature ROM (FEATURE_ROM),</p>
<p>Memmory Mapped DMA (MM_DMA),</p>
<p>Embedded Runtime Scheduler(MB_SCHEDULER),</p>
<p>Xilinx Virtual Cable (XVC_PUB, XVC_PRI),</p>
<p>System Monitor (SYSMON),</p>
<p>Axi Firewall (AF),</p>
<p>Memory Interface Generator (MIG),</p>
<p>Microblaze (MB),</p>
<p>Xilinx I2C (XIIC),</p>
<p>mailbox (MAILBOX),</p>
<p>Internal Configuration Access Port (ICAP),</p>
<p>Streaming DMA (STR_DMA),</p>
<p>XMC (XMC),</p>
<p>DNA (DNA)</p>
</div></blockquote>
</div>
<div class="section" id="debug">
<h2>Debug<a class="headerlink" href="#debug" title="Permalink to this headline">¶</a></h2>
<p>Using lspci to check if the driver is loaded successfully. And please check dmesg output if the driver is not loaded.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2019, Xilinx, Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>