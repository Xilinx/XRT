

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>XMA Core Library &mdash; Xilinx Runtime 2019.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Linux Sys FileSystem Nodes" href="sysfs.html" />
    <link rel="prev" title="Embedded Runtime Library" href="ert.main.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Xilinx Runtime
          

          
          </a>

          
            
            
              <div class="version">
                2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">XRT Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">Platform Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building and Installing Software Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">XRT Developer Build and Test Instructions</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT Use Model and Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="execution-model.html">Execution Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiprocess.html">Multi-Process Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="p2p.html">PCIe Peer-to-Peer Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="m2m.html">Memory-to-Memory (M2M) Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="xma_user_guide.html">Xilinx Media Accelerator</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT API Library</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="xrt.main.html">Xilinx Runtime (XRT) Core Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="ert.main.html">Embedded Runtime Library</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">XMA Core Library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#xma">xma</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xmaplugin">xmaplugin</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">XRT developer's space</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sysfs.html">Linux Sys FileSystem Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="formats.html">Binary Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="mgmt-ioctl.main.html">XCLMGMT (PCIe Management Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="xocl_ioctl.main.html">XOCL (PCIe User Physical Function) Driver Interfaces</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools and Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tools.html">xbutil</a></li>
<li class="toctree-l1"><a class="reference internal" href="xclbintools.html">xclbinutil</a></li>
</ul>
<p class="caption"><span class="caption-text">Platform Building</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="yocto.html">Yocto Recipes For Embedded Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">XRT Developer Build and Test Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="newxsa-bringup.html">New XSA Bringup</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_platforms.html">Create MPSoC Based Embedded Platforms</a></li>
</ul>
<p class="caption"><span class="caption-text">Cloud Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mailbox.main.html">Mailbox Subdevice Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="mailbox.proto.html">Mailbox Inter-domain Communication Protocol</a></li>
</ul>
<p class="caption"><span class="caption-text">Debug and Faqs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug-faq.html">XRT/Board Debug FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Xilinx Runtime</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>XMA Core Library</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/xma.main.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="xma-core-library">
<h1>XMA Core Library<a class="headerlink" href="#xma-core-library" title="Permalink to this headline">¶</a></h1>
<div class="section" id="xma">
<h2>xma<a class="headerlink" href="#xma" title="Permalink to this headline">¶</a></h2>
<p><strong>XMA Application Interface</strong></p>
<p>The interface used by stand-alone XMA applications or plugins</p>
<dl class="function">
<dt id="c.xma_initialize">
int32_t <code class="descname">xma_initialize</code><span class="sig-paren">(</span>char *<em> cfgfile</em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_initialize" title="Permalink to this definition">¶</a></dt>
<dd><p>the system according to the layout specified in the YAML configuration file.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*</span> <span class="pre">cfgfile</span></code></dt><dd><p>a filepath to the YAML configuration file describing
the layout of the xclbin(s) and the devices to which the xclbin(s) are
to be deployed. If a NULL value is passed, the XMA will use a default
name and location: /etc/xma/xma_def_sys_cfg.yaml.  In all cases, a
properly defined yaml configuration file must exist.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<blockquote>
<div><p>This is the entry point routine for utilzing the XMA library and must be
the first call within any application before calling any other XMA APIs.
The YAML file is parsed and then verified for compatibility with the system
hardware.  If deemed compatible, each device specified in the YAML file
will be programmed with the xclbin(s) specified in the YAML.  A shared
memory file will be created in /tmp  which will store the contents of
the YAML file *  and serve as a resource database tracking allocation of
kernels thus permitting multiple processes to share device resources.  If
the system has already been configured by a prior process, then a successful
return from this routine will map the <em>existing</em> resource database file to
the calling processes; XMA will NOT attempt to reprogram any of the system
devices if any device is in-use based on the prior configuration.
In effect, programming and and configuration of the system will only occur
when this routine is first invoked.  From the first invocation, so long as
any running process is attached to and utilizing resources for an existing
configuration, all subsequent invocations of this routine by any other
process will be forced to use the existing configuration of the system;
their configuration file argument will be ignored.
When all currently running processes attached to a given resource file
database have run to completion normally, the resource file will be deleted
and a subsequent process invoking this routine will restart the parsing and
programming of the system as would be true during initial invocation.</p>
</div></blockquote>
<p><strong>Return</strong></p>
<p>XMA_SUCCESS after successfully initializing the system and/or (if not the first process to invoke)
mapping in the currently active system configuration.</p>
<p>XMA_ERROR_INVALID if the YAML file is incompatible with the system hardware.</p>
<p>XMA_ERROR for all other errors.</p>
</div>
<div class="section" id="xmaplugin">
<h2>xmaplugin<a class="headerlink" href="#xmaplugin" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Intro from xmaplugin.h</p></li>
<li><p>xmaplugin.h autogenerated</p></li>
</ol>
<p><strong>XMA Plugin Interface</strong></p>
<p>The interface used by XMA kernel plugin developers</p>
<dl class="function">
<dt id="c.xma_plg_buffer_alloc">
XmaBufferHandle <code class="descname">xma_plg_buffer_alloc</code><span class="sig-paren">(</span>XmaHwSession<em> s_handle</em>, size_t<em> size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_plg_buffer_alloc" title="Permalink to this definition">¶</a></dt>
<dd><p>Allocate device memory This function allocates memory on the FPGA DDR and provides a handle to the memory that can be used for copying data from the host to device memory or from the device to the host. In addition, the handle can be passed to the function <strong>ref</strong> <a class="reference internal" href="#c.xma_plg_get_paddr" title="xma_plg_get_paddr"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_plg_get_paddr()</span></code></a> in order to obtain the physical address of the buffer. Obtaining the physical address is necessary for setting the AXI register map with physical pointers so that the kernel knows where key input and output buffers are located. This function knows which DDR bank is associated with this session and therefore automatically selects the correct DDR bank.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">XmaHwSession</span> <span class="pre">s_handle</span></code></dt><dd><p>The session handle associated with this plugin instance.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">size</span></code></dt><dd><p>Size in bytes of the device buffer to be allocated.</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>Non-zero buffer handle on success</p>
<dl class="function">
<dt id="c.xma_plg_buffer_free">
void <code class="descname">xma_plg_buffer_free</code><span class="sig-paren">(</span>XmaHwSession<em> s_handle</em>, XmaBufferHandle<em> b_handle</em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_plg_buffer_free" title="Permalink to this definition">¶</a></dt>
<dd><p>Free a device buffer This function frees a previous allocated buffer that was obtained using the <strong>ref</strong> <a class="reference internal" href="#c.xma_plg_buffer_alloc" title="xma_plg_buffer_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_plg_buffer_alloc()</span></code></a> function.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">XmaHwSession</span> <span class="pre">s_handle</span></code></dt><dd><p>The session handle associated with this plugin instance</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">XmaBufferHandle</span> <span class="pre">b_handle</span></code></dt><dd><p>The buffer handle returned from
<strong>ref</strong> <a class="reference internal" href="#c.xma_plg_buffer_alloc" title="xma_plg_buffer_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_plg_buffer_alloc()</span></code></a></p>
</dd>
</dl>
<dl class="function">
<dt id="c.xma_plg_get_paddr">
uint64_t <code class="descname">xma_plg_get_paddr</code><span class="sig-paren">(</span>XmaHwSession<em> s_handle</em>, XmaBufferHandle<em> b_handle</em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_plg_get_paddr" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a physical address for a buffer handle This function returns the physical address of DDR memory on the FPGA used by a specific session</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">XmaHwSession</span> <span class="pre">s_handle</span></code></dt><dd><p>The session handle associated with this plugin instance</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">XmaBufferHandle</span> <span class="pre">b_handle</span></code></dt><dd><p>The buffer handle returned from
<strong>ref</strong> <a class="reference internal" href="#c.xma_plg_buffer_alloc" title="xma_plg_buffer_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_plg_buffer_alloc()</span></code></a></p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>Physical address of DDR on the FPGA</p>
<dl class="function">
<dt id="c.xma_plg_buffer_write">
int32_t <code class="descname">xma_plg_buffer_write</code><span class="sig-paren">(</span>XmaHwSession<em> s_handle</em>, XmaBufferHandle<em> b_handle</em>, const void *<em> src</em>, size_t<em> size</em>, size_t<em> offset</em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_plg_buffer_write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write data from host to device buffer This function copies data from host to memory to device memory.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">XmaHwSession</span> <span class="pre">s_handle</span></code></dt><dd><p>The session handle associated with this plugin instance</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">XmaBufferHandle</span> <span class="pre">b_handle</span></code></dt><dd><p>The buffer handle returned from
<strong>ref</strong> <a class="reference internal" href="#c.xma_plg_buffer_alloc" title="xma_plg_buffer_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_plg_buffer_alloc()</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">void</span> <span class="pre">*</span> <span class="pre">src</span></code></dt><dd><p>Source data pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">size</span></code></dt><dd><p>Size of data to copy</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">offset</span></code></dt><dd><p>Offset from the beginning of the allocated device memory</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>XMA_SUCCESS on success
XMA_ERROR on failure</p>
<dl class="function">
<dt id="c.xma_plg_buffer_read">
int32_t <code class="descname">xma_plg_buffer_read</code><span class="sig-paren">(</span>XmaHwSession<em> s_handle</em>, XmaBufferHandle<em> b_handle</em>, void *<em> dst</em>, size_t<em> size</em>, size_t<em> offset</em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_plg_buffer_read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read data from device memory and copy to host memory This function copies data from device memory and stores the result in the requested host memory</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">XmaHwSession</span> <span class="pre">s_handle</span></code></dt><dd><p>The session handle associated with this plugin instance</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">XmaBufferHandle</span> <span class="pre">b_handle</span></code></dt><dd><p>The buffer handle returned from
<strong>ref</strong> <a class="reference internal" href="#c.xma_plg_buffer_alloc" title="xma_plg_buffer_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_plg_buffer_alloc()</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">dst</span></code></dt><dd><p>Destination data pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">size</span></code></dt><dd><p>Size of data to copy</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">offset</span></code></dt><dd><p>Offset from the beginning of the allocated device memory</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>XMA_SUCCESS on success
XMA_ERROR on failure</p>
<dl class="function">
<dt id="c.xma_plg_schedule_work_item">
int32_t <code class="descname">xma_plg_schedule_work_item</code><span class="sig-paren">(</span>XmaHwSession<em> s_handle</em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_plg_schedule_work_item" title="Permalink to this definition">¶</a></dt>
<dd><p>This function schedules a request to the XRT scheduler for execution of a kernel based on the saved state of the kernel registers supplied by the <a class="reference internal" href="#c.xma_plg_register_prep_write" title="xma_plg_register_prep_write"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_plg_register_prep_write()</span></code></a> function call. The <code class="xref c c-func docutils literal notranslate"><span class="pre">prep_write()</span></code> keeps a shadow register map so that the <code class="xref c c-func docutils literal notranslate"><span class="pre">schedule_work_item()</span></code> can gather all registers and push a new work item onto the scheduler queue. Work items are processed in FIFO order. After calling <code class="xref c c-func docutils literal notranslate"><span class="pre">schedule_work_item()</span></code> one or more times, the caller can invoke <a class="reference internal" href="#c.xma_plg_is_work_item_done" title="xma_plg_is_work_item_done"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_plg_is_work_item_done()</span></code></a> to wait for one item of work to complete.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">XmaHwSession</span> <span class="pre">s_handle</span></code></dt><dd><p>The session handle associated with this plugin instance</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>XMA_SUCCESS on success</p>
<p>XMA_ERROR on failure</p>
<dl class="function">
<dt id="c.xma_plg_is_work_item_done">
int32_t <code class="descname">xma_plg_is_work_item_done</code><span class="sig-paren">(</span>XmaHwSession<em> s_handle</em>, int32_t<em> timeout_in_ms</em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_plg_is_work_item_done" title="Permalink to this definition">¶</a></dt>
<dd><p>This function checks if at least one work item previously submitted via <a class="reference internal" href="#c.xma_plg_schedule_work_item" title="xma_plg_schedule_work_item"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_plg_schedule_work_item()</span></code></a> has completed. If the supplied timeout expires before a work item has completed, this function returns an error.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">XmaHwSession</span> <span class="pre">s_handle</span></code></dt><dd><p>The session handle associated with this plugin instance</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int32_t</span> <span class="pre">timeout_in_ms</span></code></dt><dd><p>A timeout value in milliseconds</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>XMA_SUCCESS on success</p>
<p>XMA_ERROR on timeout</p>
<dl class="function">
<dt id="c.xma_plg_register_prep_write">
int32_t <code class="descname">xma_plg_register_prep_write</code><span class="sig-paren">(</span>XmaHwSession<em> s_handle</em>, void *<em> dst</em>, size_t<em> size</em>, size_t<em> offset</em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_plg_register_prep_write" title="Permalink to this definition">¶</a></dt>
<dd><p>This function writes the data provided and sets the specified AXI_Lite register(s) exposed by a kernel. The base offset of 0 is the beginning of the kernels AXI_Lite memory map as this function adds the required offsets internally for the kernel and PCIe.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">XmaHwSession</span> <span class="pre">s_handle</span></code></dt><dd><p>The session handle associated with this plugin instance</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">dst</span></code></dt><dd><p>Destination data pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">size</span></code></dt><dd><p>Size of data to copy</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">offset</span></code></dt><dd><p>Offset from the beginning of the kernel AXI_Lite register
register map</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>&gt;=0 number of bytes written</p>
<p>&lt;0 on failure</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sysfs.html" class="btn btn-neutral float-right" title="Linux Sys FileSystem Nodes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ert.main.html" class="btn btn-neutral float-left" title="Embedded Runtime Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2019, Xilinx, Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>