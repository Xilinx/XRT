

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Security of Alveo Platform &mdash; Xilinx Runtime 2019.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="XRT/Board Debug FAQ" href="debug-faq.html" />
    <link rel="prev" title="Mailbox Inter-domain Communication Protocol" href="mailbox.proto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Xilinx Runtime
          

          
          </a>

          
            
            
              <div class="version">
                2019.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">XRT Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">Platform Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building and Installing Software Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">XRT Developer Build and Test Instructions</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT Use Model and Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="execution-model.html">Execution Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrt_kernel_executions.html">XRT Supported Kernel Execution Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiprocess.html">Multi-Process Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="p2p.html">PCIe Peer-to-Peer Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="m2m.html">Memory-to-Memory (M2M) Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="xma_user_guide.html">Xilinx Media Accelerator (XMA)</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT API Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="xrt.main.html">Xilinx Runtime (XRT) Core Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="ert.main.html">Embedded Runtime Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="xma.main.html">XMA Core Library</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT developer's space</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sysfs.html">Linux Sys FileSystem Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="formats.html">Binary Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="mgmt-ioctl.main.html">XCLMGMT (PCIe Management Physical Function) Driver Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="xocl_ioctl.main.html">XOCL (PCIe User Physical Function) Driver Interfaces</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools and Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tools.html">xbutil</a></li>
<li class="toctree-l1"><a class="reference internal" href="xclbintools.html">xclbinutil</a></li>
</ul>
<p class="caption"><span class="caption-text">Platform Building</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="yocto.html">Yocto Recipes For Embedded Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">XRT Developer Build and Test Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="newxsa-bringup.html">New XSA Bringup</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_platforms.html">Create MPSoC Based Embedded Platforms</a></li>
</ul>
<p class="caption"><span class="caption-text">Cloud Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mailbox.main.html">Mailbox Subdevice Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="mailbox.proto.html">Mailbox Inter-domain Communication Protocol</a></li>
</ul>
<p class="caption"><span class="caption-text">Security</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Security of Alveo Platform</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#shell">Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-function-exchange">Dynamic Function eXchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xclbin-generation">Xclbin Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#firewall">Firewall</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deployment-models">Deployment Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#baremetal">Baremetal</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pass-through-virtualization">Pass-through Virtualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#signing-of-xclbins">Signing of Xclbins</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mailbox">Mailbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="#device-reset-and-recovery">Device Reset and Recovery</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Debug and Faqs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug-faq.html">XRT/Board Debug FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Xilinx Runtime</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Security of Alveo Platform</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/security.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="security-of-alveo-platform">
<span id="security-rst"></span><h1>Security of Alveo Platform<a class="headerlink" href="#security-of-alveo-platform" title="Permalink to this headline">¶</a></h1>
<div align="center" class="align-center"><img alt="_images/XSA-shell.svg" src="_images/XSA-shell.svg" /></div>
<p>Security is built into Alveo platform hardware and software architecture. The platform
is made up of
two physical partitions: an immutable Shell and user compiled DFX partition. This
design allows end users to perform Dynamic Function eXchange (Partial Reconfiguration
in classic FPGA terminology) in the well defined DFX partition while the static Shell
provides key services.</p>
<div class="section" id="shell">
<h2>Shell<a class="headerlink" href="#shell" title="Permalink to this headline">¶</a></h2>
<p>The Shell provides core infrastructure to the Alveo platform. It includes hardened PCIe
block which provides physical connectivity to the host PCIe bus via two physical functions
as described in <a class="reference internal" href="platforms.html#platforms-rst"><span class="std std-ref">Platform Overview</span></a>.
The Shell is <em>trusted</em> partition of the Alveo platform and for all practical purposes
should be treated as an ASIC. The Shell is loaded on system boot from PROM. The Shell
cannot be changed once the system is up.</p>
<p>In the figure above, the Shell peripherals shaded blue can only be accessed from physical
function 0 (PF0). The Shell peripherals shaded violet can be accessed from physical
function 1 (PF1). From PCIe topology point of view PF0 <strong>owns</strong> the device and performs
supervisory actions on the device. Peripherals shaded blue are trusted but peripherals
shaded violet are not. A malicious actor who has direct access to blue shaded peripherals
can crash the device and PCIe bus. However, a malicious actor who has direct access to
violet shaded peripherals cannot crash the device or PCIe bus. This is particularly
significant in pass-through virtualization deployment as discussed later.</p>
<p>All peripherals in the shell except XDMA are slaves from PCIe point of view and cannot
initiate PCIe transactions. <a class="reference external" href="https://www.xilinx.com/support/documentation/ip_documentation/xdma/v4_1/pg195-pcie-dma.pdf">XDMA</a>
is a regular PCIe scatter gather DMA engine with a well defined programming model.</p>
<p>The Shell provides a <em>control</em> path and a <em>data</em>
path to the user compiled image loaded on DFX partition. The Firewalls in control and data
paths protect the Shell from un-trusted DFX partition. For example if a slave in DFX has a
bug or is malicious the appropriate firewall will step in and protect the Shell from the
failing slave.</p>
<p>The shell image is itself distributed as signed RPM and DEB package files by Xilinx.
Shells may be upgraded using XRT <strong>xbmgmt</strong> tool by system administrators. The upgrade
process will update the PROM.</p>
</div>
<div class="section" id="dynamic-function-exchange">
<h2>Dynamic Function eXchange<a class="headerlink" href="#dynamic-function-exchange" title="Permalink to this headline">¶</a></h2>
<p>User compiled image packaged as xclbin is loaded on the Dynamic Functional eXchange
partition by the Shell. The image may be signed with a private key and its public
key should be registered with Linux kernel keyring. The xclbin signature is validated by
xclmgmt driver. This guarantees that only known good user compiled images are loaded by the
Shell. The image load is itself effected by xclmgmt driver which binds to the PF0.</p>
<p>xclbin is a container which packs FPGA bitstream for the DFX partition and host of related
metadata like clock frequencies, information about instantiated compute units, etc. The
compute units typically expose a well defined register space on the PCIe BAR for access by
XRT. An user compiled image does not have any physical path to directly interact with PCIe
Bus. Compiled images do have access to device DDR.</p>
</div>
<div class="section" id="xclbin-generation">
<h2>Xclbin Generation<a class="headerlink" href="#xclbin-generation" title="Permalink to this headline">¶</a></h2>
<p>Users compile their Verilog/VHDL/OpenCL/C/C++ design using SDx compiler which also takes
the shell specification as a second input. By construction the SDx compiler generates image
compatible with DFX partition of the shell. The compiler uses a technology called <em>PR Verify</em>
to ensure that the user design physically confines itself to DFX partition and does not attempt
to overwrite portions of the Shell.</p>
</div>
<div class="section" id="firewall">
<h2>Firewall<a class="headerlink" href="#firewall" title="Permalink to this headline">¶</a></h2>
<p>Alveo hardware design uses standard AXI bus. As shown in the figure the control path uses AXI-Lite
and data path uses AXI4 full. Specialized hardware element called AXI Firewall monitors all transactions
going across the bus into the un-trusted DFX partition. It is possible that one or more AXI slave in the DFX
partition is not fully AXI-compliant or deadlocks/stalls/hangs during operation. When an AXI slave in DFX
partition fails AXI Firewall <em>trips</em> – it starts completing AXI transactions on behalf of the slave so the
master and the specific AXI bus is not impacted – to protect the Shell. The AXI Firewall starts completing
all transactions on behalf of misbehaving slave while also notifying the mgmt driver about the trip. The
mgmt driver then starts taking recovery action.</p>
</div>
<div class="section" id="deployment-models">
<h2>Deployment Models<a class="headerlink" href="#deployment-models" title="Permalink to this headline">¶</a></h2>
<div class="section" id="baremetal">
<h3>Baremetal<a class="headerlink" href="#baremetal" title="Permalink to this headline">¶</a></h3>
<p>In Baremetal deployment model, both physical functions are visible to the end user who <em>does not</em>
have root privileges. End user have access to both XRT <strong>xclmgmt</strong> and XRT <strong>xocl</strong> drivers. The system
administrator trusts both drivers which provide well defined <a class="reference internal" href="mgmt-ioctl.main.html#mgmt-ioctl-main-rst"><span class="std std-ref">XCLMGMT (PCIe Management Physical Function) Driver Interfaces</span></a> and <a class="reference internal" href="xocl_ioctl.main.html#xocl-ioctl-main-rst"><span class="std std-ref">XOCL (PCIe User Physical Function) Driver Interfaces</span></a>.
End user does have the privilege to load xclbins which should be signed for maximum security. This
will ensure that only known good xclbins are loaded by end users.</p>
<p>Certain operations like resetting the board and upgrading the flash image on PROM (from which the shell
is loaded on system boot) require root privileges and are effected by xclmgmt driver.</p>
</div>
<div class="section" id="pass-through-virtualization">
<h3>Pass-through Virtualization<a class="headerlink" href="#pass-through-virtualization" title="Permalink to this headline">¶</a></h3>
<p>In Pass-through Virtualization deployment model, management physical function is only visible to the host
but user physical function is visible to the guest VM. Host considers the guest VM a <em>hostile</em> environment.
End users in guest VM may be root and may be running modified implementation of XRT <strong>xocl</strong> driver – XRT
<strong>xclmgmt</strong> driver does not trust XRT xocl driver. xclmgmt as described before exposes well defined
<a class="reference internal" href="mgmt-ioctl.main.html#mgmt-ioctl-main-rst"><span class="std std-ref">XCLMGMT (PCIe Management Physical Function) Driver Interfaces</span></a> to the host. In a good and clean deployment end users in guest VM interact with
standard xocl using well defined <a class="reference internal" href="xocl_ioctl.main.html#xocl-ioctl-main-rst"><span class="std std-ref">XOCL (PCIe User Physical Function) Driver Interfaces</span></a>.</p>
<p>As explained under the Shell section above, by design xocl has limited access to violet shaded Shell peripherals.
This ensures that users in guest VM cannot perform any privileged operation like updating flash image or device
reset. A user in guest VM can only perform operations listed under USER PF (PF1) section in <a class="reference internal" href="platforms.html#platforms-rst"><span class="std std-ref">Platform Overview</span></a>.</p>
<p>A guest VM user can potentially crash a compute unit in DFX partition, deadlock data path AXI bus or corrupt
device memory. If the user has root access he may compromise VM memory. But none of this can bring down the
host or the PCIe bus. Host memory is protected by system IOMMU. Device reset and recovery is described below.</p>
<p>A user cannot load a malicious xclbin on the DFX partition since xclbin downloads are done by xclmgmt
drive. xclbins are passed on to the host via a plugin based MPD/MSD framework defined in
<a class="reference internal" href="mailbox.main.html#mailbox-main-rst"><span class="std std-ref">Mailbox Subdevice Driver</span></a>. Host can add any extra checks necessary to validate xclbins received from guest VM.</p>
<p>This deployment model is ideal for public cloud where host does not trust the guest VM. This is the prevalent
deployment model for FaaS operators.</p>
</div>
<div class="section" id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-center">
<colgroup>
<col style="width: 31%" />
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2" rowspan="2"><p>Behavior</p></th>
<th class="head" colspan="2"><p>Deployment Model</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Bare Metal</p></th>
<th class="head"><p>Pass-through</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td rowspan="2"><p>System admin
trusted driver</p></td>
<td><p>xocl</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>xclmgmt</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>End user root
access</p></td>
<td><p>xocl</p></td>
<td><p>No</p></td>
<td><p>Maybe</p></td>
</tr>
<tr class="row-even"><td><p>xclmgmt</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>End user can crash device</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>End user can crash PCIe bus</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>End user with root access
can crash PCIe bus</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="signing-of-xclbins">
<h2>Signing of Xclbins<a class="headerlink" href="#signing-of-xclbins" title="Permalink to this headline">¶</a></h2>
<p>xclbin signing process is similar to signing of Linux kernel modules. xclbins can be signed by XRT tool,
<strong>xclbinutil</strong>. The signing adds a PKCS7 signature at the end of xclbin. The signing certificate is then
registered with appropriate key-ring. XRT supports one of three levels of security which can be configured
with xbmgmt tool running with root privileges.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Security level</p></th>
<th class="head"><p>xclmgmt driver xclbin signature verification behavior</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>No verification</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Signature verification enforced using signing certificate in
<em>.xilinx_fpga_xclbin_keys</em> key-ring</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Linux is running in UEFI secure mode and signature verification
is enforced using signing certificate in <em>system</em> key-ring</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mailbox">
<h2>Mailbox<a class="headerlink" href="#mailbox" title="Permalink to this headline">¶</a></h2>
<p>Mailbox is used for communication between user physical function driver, xocl and management physical
function driver, xclmgmt. The Mailbox hardware design and xclmgmt driver mailbox handling implementation
has the ability to throttle requests coming from xocl which
protects it from DoS initiated by a malicious xocl. <a class="reference internal" href="mailbox.main.html#mailbox-main-rst"><span class="std std-ref">Mailbox Subdevice Driver</span></a> has details on mailbox usage.</p>
</div>
<div class="section" id="device-reset-and-recovery">
<h2>Device Reset and Recovery<a class="headerlink" href="#device-reset-and-recovery" title="Permalink to this headline">¶</a></h2>
<p>Device reset and recovery is a privileged operation and can only be performed by xclmgmt driver. xocl
driver can request device reset by sending a message to xclmgmt driver over the Mailbox. An end user
can reset a device by using XRT <strong>xbutil</strong> tool. This tool talks to xocl driver which uses the reset
message as defined in <a class="reference internal" href="mailbox.main.html#mailbox-main-rst"><span class="std std-ref">Mailbox Subdevice Driver</span></a></p>
<p>Currently Alveo boards are reset by using PCIe bus <em>hot reset</em> mechanism. This resets the board peripherals
and also the PCIe link. The drivers reset their platform devices and kill all the clients which have opened
the device node by sending them a SIGBUS.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="debug-faq.html" class="btn btn-neutral float-right" title="XRT/Board Debug FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mailbox.proto.html" class="btn btn-neutral float-left" title="Mailbox Inter-domain Communication Protocol" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2019, Xilinx, Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>